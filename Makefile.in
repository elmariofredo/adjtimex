#### Start of system configuration section.             -*-makefile-*- ####
 srcdir = .
VPATH = .

VERSION=1.10

CFLAGS = @CFLAGS@
prefix = @prefix@
man1dir=@mandir@/man1
exec_prefix = @exec_prefix@
bindir=/sbin

INSTALL=@INSTALL@

# Extension (not including `.') for the manual page filenames.
manext = 8
# Where to put the manual pages.
mandir = $(prefix)/man/man$(manext)

#### End of system configuration section. ####

SHELL = /bin/sh

SRC = adjtimex.c adjtimex.8 mat.c mat.h install-sh configure.in		\
 configure Makefile.in README adjtimex.lsm adjtimex.lsm.in COPYING	\
 COPYRIGHT ChangeLog

all: adjtimex adjtimex.lsm

adjtimex: adjtimex.c mat.o
	$(CC) $(CFLAGS) -I. -DVERSION=\"$(VERSION)\" -o adjtimex adjtimex.c  \
		mat.o -lm

adjtimex.lsm: adjtimex.lsm.in
	sed s/@VERSION@/$(VERSION)/ adjtimex.lsm.in >adjtimex.lsm

mat.o: mat.c
	$(CC) $(CFLAGS) -c mat.c

install: all
	$(INSTALL) -g bin -m 755 -o root adjtimex $(bindir)/adjtimex
	-$(INSTALL) -g man -m 444 -o root $(srcdir)/adjtimex.8 \
		$(mandir)/adjtimex.$(manext)

uninstall:
	rm -f $(bindir)/adjtimex $(mandir)/adjtimex.$(manext)

clean: 
	rm -f core *.o
veryclean: clean
	rm -f adjtimex

shar: $(SRC)
	distname=adjtimex-$(VERSION);		\
	shar $(SRC) >$$distname.shar 

dist: $(SRC)
	distname=adjtimex-$(VERSION);					      \
	rm -fr $$distname;						      \
	mkdir $$distname;						      \
	for file in $(SRC); do						      \
	  ln $$file $$distname/$$file					      \
	  || { echo copying $$file instead; cp -p $$file $$distname/$$file;}; \
	done;								      \
	chmod -R a+rX $$distname;					      \
	tar -chz -f $$distname.tar.gz $$distname;			      \
	rm -fr $$distname
